<!DOCTYPE html>

<html>
    <head>
        <title>WebGL Pipelines</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="../../../css/style.css">
        <link rel="stylesheet" href="../../../css/document.css">
        
        <style type="text/css">
            img {
                border: 1px solid #666;
                box-shadow: 3px 3px 3px #666;
                display: block;
                margin: 0 auto;
            }
        </style>
        
        <script src="../../../js/htmlDocUtils.js"></script>
    </head>
    <body>
        <article>
            <header>
                <h1>WebGL Pipelines</h1>
                <p class='authorinfo'>Sarkuya, <time>2019-05-19</time></p>
            </header>
            
            <section class="chapter">
                <h1>How WebGL Draw</h1>
                <p>In order to draw something in the canvas, we need to issue certain drawing methods. WebGL has only 3 methods dealing with drawing:</p>
                <ul>
                    <li>clear</li>
                    <li>drawArrays</li>
                    <li>drawElements</li>
                </ul>
                <p>We have encountered the <span class="function-name">clear</span> method before, and in the following section we'll talk about <span class="function-name">drawElements</span>. In this section, we discuss <span class="function-name">drawArrays</span> first.</p>
                <p>Suppose we shall draw a triangle. First, we need to provide the vertices. Second, issue the drawing method. The code is below:</p>
                <pre class="highlight">
var vertices = [
     0.0,  0.5,
    -0.5, -0.5,
     0.5, -0.5
];

gl.drawArrays(gl.TRIANGLES, 0, 3);  // intent: use the array data in vertices to draw a triangle
</pre>
                <p>The synopsis of the <span class="function-name">drawArrays</span> is as followed.</p>
                <pre>void drawArrays(GLenum mode, GLint first, GLsizei count)</pre>
                <p>There are 3 points in vertices array data. From the first point, which starting index is 0, fetches altogether 3 points to draw triangles. In this situation, 3 points would compose only 1 triangle.</p>
                <p>You can see from the code that there are no connections between the <span class="function-name">drawArrays</span> and the vertices. So how WebGL know where to get the array data from?</p>
                <p>WebGL will rather get the array data from a buffer, than directly from the vertices we are providing. The buffer is resident in GPU, and the speed of data transmission from it is much faster than from the vertices, which is resident in JavaScript client side.</p>
                <p>So, we need to do the following jobs:</p>
                <ol>
                    <li>create a buffer (in GPU)</li>
                    <li>copy the data from the vertices to the buffer</li>
                    <li>tell WebGL to fetch array data from the buffer</li>
                </ol>
                <pre class="highlight">
var buffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buffer);

var vertices = [
     0.0,  0.5,
    -0.5, -0.5,
     0.5, -0.5
];

gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
</pre>
                <p>Notice the first argument of the <span class="function-name">bufferData</span> is gl.ARRAY_BUFFER. This is the specific buffer where the WebGL would fetch the array data. So after we created a buffer, we bind the buffer to the target gl.ARRAY_BUFFER. So the array data from the vertices would be copied to the GPU's buffer.</p>
                buffer
                <img src="images/svg/pipelines.svg" alt="WebGL Pipelines" />
                
                <p></p>
                
<!--                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="482px" height="140px">
                    <defs>
                        <marker id="triangle" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="strokeWidth" markerWidth="4" markerHeight="3" orient="auto">
                            <path d="M 0 0 L 10 5 L 0 10 z" fill="green" />
                        </marker>
                    </defs>
                    
                    <text x="10" y="20" font-family="verdana" font-size="12" fill="black">JavaScript Client</text>
                    <text x="250" y="20" font-family="verdana" font-size="12" fill="black">WebGL (GPU)</text>
                    
                    <line x1="5" y1="30" x2="477" y2="30" stroke="#ccc" />
                    <line x1="120" y1="5" x2="120" y2="130" stroke="#ccc" />
                    
                    <rect x="25" y="80" width="70" height="30" fill="#ccc" stroke="#999" />
                    <text x="35" y="99" font-family="verdana" font-size="12" fill="#333">vertices</text>
                    
                    <text x="122" y="55" font-family="verdana" font-size="12" fill="brown">ARRAY_BUFFER</text>
                    <rect x="165" y="65" width="10" height="10" fill="white" stroke="#333" />
                    
                    <path d="M 100 95 h 30 v -25 h 20 " fill="none" stroke="green" stroke-width="3" marker-end="url(#triangle)" />
                    <path d="M 182 70 h 25 v 25 h 20 " fill="none" stroke="green" stroke-width="3" marker-end="url(#triangle)" />
                    
                    <rect x="245" y="80" width="70" height="30" fill="#ccc" stroke="#999" />
                    <text x="262" y="99" font-family="verdana" font-size="12" fill="#333">buffer</text>
                    
                    <path d="M 320 95 h 75 " fill="none" stroke="green" stroke-width="3" marker-end="url(#triangle)" />
                    <text x="326" y="87" font-family="verdana" font-size="10" fill="#999">drawArrays()</text>
                    
                    <rect x="410" y="70" width="50" height="50" fill="black" stroke="#eee" />
                    <path d="M 435 78 l -15 30 l 30 0 z" fill="yellow" stroke="black" />
                    
                    <text x="100" y="112" font-family="verdana" font-size="10" fill="#999">bufferData()</text>
                    <text x="180" y="112" font-family="verdana" font-size="10" fill="#999">bindBuffer()</text>
                    
                    <text x="400" y="60" font-family="verdana" font-size="10" fill="#000">Frame Buffer</text>
                    
                </svg>-->
                
                <p>We need to deal with the following objects:</p>
                <ul>
                    <li>WebGLRenderingContext</li>
                    <li>shaders</li>
                    <li>program</li>
                    <li>buffer</li>
                    <li>vertices</li>
                    <li>drawing functions</li>
                </ul>
            </section>
            
            <section class="chapter">
                <h1>Coming the Shaders</h1>
                <p>Is it the whole story? Not yet.</p>
            </section>

            <section class="reference">
                <h1>References</h1>
                <ul>
                    <li><a href="https://www.khronos.org/registry/OpenGL/specs/es/2.0/es_full_spec_2.0.pdf#nameddest=section-2.8" target="_blank">OpenGL ES 2.0 Specification (PDF)</a></li>
                    
                    <li><a href="https://www.khronos.org/registry/webgl/specs/latest/1.0/" target="_blank">WebGL 1.0 Specification</a></li>
                    <li><a href="https://www.khronos.org/registry/OpenGL-Refpages/es2.0/xhtml/glDrawArrays.xml" target="_blank">glDrawArrays</a></li>
                    <li><a href="https://www.w3.org/TR/SVG11/" target="_blank">SVG 1.1 Specification</a></li>
                    
                </ul>
            </section>
            
            <p>Previous: <a>Introduction</a> | <a>Table of Contents</a> | Next: <a>Drawing</a></p>
            
            <footer><p class="copyright">All rights reserved.</p></footer>
        </article>
    </body>
</html>
